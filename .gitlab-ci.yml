#define the base docker image file
image : composer:2.2

#prepare container with some extra configuration
before_script:
  - 'command -v ssh-agent >/dev/null || ( apt-get update -y && apt-get install openssh-client -y )'
  - mkdir -p ~/.ssh
  - eval `ssh-agent -s`
  - ssh-add <(echo "$SSH_PRIVATE_KEY")
  - chmod 700 ~/.ssh
  - ssh-keyscan shell.studev.groept.be > ~/.ssh/known_hosts
  - apk add rsync

deploy-job:
  only:
    - dev
    - main
  when: manual
  script:
    - composer install
    - rsync -rv --exclude=".git/"
                --exclude=".env"
                --exclude="vendor/"
                --exclude="var/"
                ./ a23www301@shell.studev.groept.be:/var/www/html